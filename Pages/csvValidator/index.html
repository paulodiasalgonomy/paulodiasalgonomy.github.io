<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        table{
            max-width: 100%;
            width: 100%;
            word-break:break-all;
            margin-bottom: 20px;
            border: 0;
        }
        tr{


        }
        td{
            min-width: 135px;
            border: 0;
            border-bottom: 1px dotted #212121;
            padding-top: 0.4%;
            padding-bottom: 0.1%;
        }
        .bg-recs4P {
            background-color: #c3e3ff ;
        }

        .bg-RecsClick{
            background-color: #cccccc ;
        }
        .bg-Personalize{
            background-color: #f9c3ff ;          
        }
        .bg-FindClick{
            background-color: #d7d89f ;
        }
        .bg-Find{
            background-color: #f9fcb3 ;    
        }

        .bg-Autocomplete{
            background-color: #fcdea2 ;    
        }

        .bg-Discover{
            background-color: #a2fcc1 ;    
        }     
        .selectt {
            color: #fff;
            padding: 30px;
            display: none;
            margin-top: 30px;
            width: 60%;
            background: green
        }
        fieldset{
            margin-top: 20px;
            margin-bottom: 20px;
        }
    </style>
    <title>Algonomy API Request Validation</title>
    <script src="https://code.jquery.com/jquery-3.6.1.slim.min.js" integrity="sha256-w8CvhFs7iHNVUtnSP0YKEg00p9Ih13rlL9zGqvLdePA=" crossorigin="anonymous"></script>
    <script>
        function getTag(id){
            return document.getElementById(id);
        }
        function splitLines(txt){
            var splitted = txt.replace(/\"\@timestamp(.*)type.keyword\"/g,"");
            splitted = splitted.replace(/\"(.*)hostName"":""/g,"&host=");
            splitted = splitted.replace(/\"",""timestamp(.*) \- \- /g,"&time=");
            splitted = splitted.replace(/ \+/g,"-");
            splitted = splitted.replace(/ ""GET /g,"&apiRequest="); 
            splitted = splitted.replace(/\ HTTP\/(.*)/g,";");
            splitted = splitted.replace(/\n/g,"");
            splitted = splitted.replace(/\;\n/g,";");
            splitted = splitted.replace(/\?/g,"&");
            //splitted = splitted.replace(/\/rrserver\/api\/find\/v1\//g,"/rrserver/api/find/v1/apiKey=");
            splitted = splitted.replace(/\/rrserver\/api\/find\/v1\/track\/click\//g,"/rrserver/api/find/v1/track/click/apiKey=");
            return splitted;
        }
        function readRequest(url,rcsCount,rcsArray){
            const paramsString = url;
            const searchParams = new URLSearchParams(paramsString);
            const api = (searchParams.getAll('apiRequest'));
            var newHTML = '';

            if (api == "/rrserver/api/rrPlatform/recsForPlacements"){
                newHTML += "<table border='0' class='bg-recs4P'>";
                    let placementCheck = '';
                    placementCheck = (searchParams.getAll('placements') != 'null') ? (placementCheck ='<img src="ok.png" width="15"/> ') : (placementCheck ='<img src="error.png" width="15"/> '); 
                    newHTML +="<tr class='bg-recs4P'><td><b>Placement </b></td><td><b>"+ placementCheck + searchParams.getAll('placements') + "</b></td></tr>";  
                    newHTML +="<tr class='bg-recs4P'><td ><b>API </b></td><td><b>"+api + "</b></td></tr>";
                    newHTML +="<tr class='bg-recs4P'><td>API Client Key </td><td>"+ searchParams.getAll('apiClientKey') + "</b></td></tr>";
                    newHTML +="<tr class='bg-recs4P'><td>User Id </td><td>"+ searchParams.getAll('userId') + "</b></td></tr>"; 
                    newHTML +="<tr class='bg-recs4P'><td>Session Id </td><td>"+ searchParams.getAll('sessionId') + "</b></td></tr>";  
                    newHTML +="<tr class='bg-recs4P'><td>Rcs </td><td>"+ searchParams.getAll('rcs') + "</b></td></tr>"; 
                    if (rcsArray[rcsArray.length - 1] == searchParams.getAll('rcs')[0]){
                        rcsCount = rcsCount  + 1;
                    }
                    let rcs =  searchParams.getAll('rcs')[0];
                    rcsArray.push(rcs);
                    if(searchParams.get('placements').includes("purchase_complete_page")){ 
                        newHTML +="<tr class='bg-recs4P'><td>productId </td><td>"+ searchParams.getAll('productId') + "</b></td></tr>";  
                        newHTML +="<tr class='bg-recs4P'><td>o </td><td>"+ searchParams.getAll('o') + "</b></td></tr>";  
                        newHTML +="<tr class='bg-recs4P'><td>pp </td><td>"+ searchParams.getAll('pp') + "</b></td></tr>";  
                        newHTML +="<tr class='bg-recs4P'><td>q </td><td>"+ searchParams.getAll('q') + "</b></td></tr>";   
                    }  
                    if(searchParams.get('placements').includes("add_to_cart_page")){ 
                        newHTML +="<tr class='bg-recs4P'><td>atcId </td><td>"+ searchParams.getAll('atcId') + "</b></td></tr>";   
                    }  
                    if((searchParams.get('placements') == ("cart_page")) || (searchParams.get('placements').includes("item_page"))){ 
                        newHTML +="<tr class='bg-recs4P'><td>productId </td><td>"+ searchParams.getAll('productId') + "</b></td></tr>";  
                    }  
                    if(searchParams.get('placements').includes("category_page")){ 
                        newHTML +="<tr class='bg-recs4P'><td>CategoryId </td><td>"+ searchParams.getAll('categoryId') + "</b></td></tr>";   
                    }  
                    if(searchParams.get('placements').includes("search_page")){ 
                        newHTML +="<tr class='bg-recs4P'><td>CategoryId </td><td>"+ searchParams.getAll('categoryId') + "</b></td></tr>";   
                    }  
                newHTML +="</table>";
            }else if(api == "/rrserver/api/find/v1/e20fd45b1e19a8c6"){
                newHTML +="<table border='0' class='bg-Find'>";
                    newHTML +="<tr class='bg-Find'><td><b>Placement </b></td><td><b>"+ searchParams.getAll('placement') + "</b></td></tr>";  
                    newHTML +="<tr class='bg-Find'><td ><b>API </b></td><td><b>"+api + "</b></td></tr>";
                    newHTML +="<tr class='bg-Find'><td>Query</td><td>"+ searchParams.getAll('query') + "</b></td></tr>";
                    newHTML +="<tr class='bg-Find'><td>User Id </td><td>"+ searchParams.getAll('userId') + "</b></td></tr>"; 
                    newHTML +="<tr class='bg-Find'><td>Session Id </td><td>"+ searchParams.getAll('sessionId') + "</b></td></tr>";  
                    newHTML +="<tr class='bg-Find'><td>Rcs </td><td>"+ searchParams.getAll('rcs') + "</b></td></tr>"; 
                    newHTML +="<tr class='bg-Find'><td>start</td><td>"+ searchParams.getAll('start') + "</b></td></tr>";  
                    newHTML +="<tr class='bg-Find'><td>Rows </td><td>"+ searchParams.getAll('rows') + "</b></td></tr>"; 
                    newHTML +="<tr class='bg-Find'><td>Log </td><td>"+ searchParams.getAll('log') + "</b></td></tr>";  
                    newHTML +="<tr class='bg-Find'><td>Fl </td><td>"+ searchParams.getAll('fl') + "</b></td></tr>"; 
                    newHTML +="<tr class='bg-Find'><td>filter </td><td>"+ searchParams.getAll('filter') + "</b></td></tr>";  
                    newHTML +="<tr class='bg-Find'><td>lang </td><td>"+ searchParams.getAll('lang') + "</b></td></tr>"; 
                    newHTML +="<tr class='bg-Find'><td>facetDepth </td><td>"+ searchParams.getAll('facetDepth') + "</b></td></tr>"; 
                    newHTML +="<tr class='bg-Find'><td>ssl </td><td>"+ searchParams.getAll('ssl') + "</b></td></tr>"; 
                newHTML +="</table>";               
            }else if(api == "/rrserver/api/personalize"){
                newHTML +="<table border='0' class='bg-Personalize'>";
                    newHTML +="<tr class='bg-Personalize'><td><b>Placement </b></td><td><b>"+ searchParams.getAll('placements') + "</b></td></tr>";  
                    newHTML +="<tr class='bg-Personalize'><td ><b>API </b></td><td><b>"+api + "</b></td></tr>";
                    newHTML +="<tr class='bg-Personalize'><td>API Client Key </td><td>"+ searchParams.getAll('apiClientKey') + "</b></td></tr>";
                    newHTML +="<tr class='bg-Personalize'><td>User Id </td><td>"+ searchParams.getAll('userId') + "</b></td></tr>"; 
                    newHTML +="<tr class='bg-Personalize'><td>Session Id </td><td>"+ searchParams.getAll('sessionId') + "</b></td></tr>";  
                    newHTML +="<tr class='bg-Personalize'><td>ipor </td><td>"+ searchParams.getAll('ipor') + "</b></td></tr>"; 
                    newHTML +="<tr class='bg-Personalize'><td>ssl </td><td>"+ searchParams.getAll('ssl') + "</b></td></tr>"; 
                    newHTML +="<tr class='bg-Personalize'><td>excludeHtml </td><td>"+ searchParams.getAll('excludeHtml') + "</b></td></tr>"; 
                    newHTML +="<tr class='bg-Personalize'><td>includeRcs </td><td>"+ searchParams.getAll('includeRcs') + "</b></td></tr>"; 
                newHTML +="</table>";
            }else if(api == "/rrserver/api/find/v1/track/click/e20fd45b1e19a8c6"){
                newHTML +="<table border='0' class='bg-FindClick'>";
                    newHTML +="<tr class='bg-FindClick'><td ><b>API </b></td><td><b>"+api + "</b></td></tr>";
                    newHTML +="<tr class='bg-FindClick'><td>vg </td><td>"+ searchParams.getAll('vg') + "</td></tr>";  
                    newHTML +="<tr class='bg-FindClick'><td>pti </td><td>"+ searchParams.getAll('pti') + "</b></td></tr>";
                    newHTML +="<tr class='bg-FindClick'><td>pa </td><td>"+ searchParams.getAll('pa') + "</b></td></tr>"; 
                    newHTML +="<tr class='bg-FindClick'><td>hpi </td><td>"+ searchParams.getAll('hpi') + "</b></td></tr>";  
                    newHTML +="<tr class='bg-FindClick'><td>stn </td><td>"+ searchParams.getAll('stn') + "</b></td></tr>"; 
                    newHTML +="<tr class='bg-FindClick'><td>stid </td><td>"+ searchParams.getAll('stid') + "</b></td></tr>"; 
                    newHTML +="<tr class='bg-FindClick'><td>rti </td><td>"+ searchParams.getAll('rti') + "</b></td></tr>"; 
                    newHTML +="<tr class='bg-FindClick'><td>sgs </td><td>"+ searchParams.getAll('sgs') + "</b></td></tr>"; 
                    newHTML +="<tr class='bg-FindClick'><td>a </td><td>"+ searchParams.getAll('a') + "</b></td></tr>"; 
                    newHTML +="<tr class='bg-FindClick'><td>qsgs </td><td>"+ searchParams.getAll('qsgs') + "</b></td></tr>"; 
                    newHTML +="<tr class='bg-FindClick'><td>u </td><td>"+ searchParams.getAll('u') + "</b></td></tr>"; 
                    newHTML +="<tr class='bg-FindClick'><td>mvtId </td><td>"+ searchParams.getAll('mvtId') + "</b></td></tr>"; 
                    newHTML +="<tr class='bg-FindClick'><td>mvtTs </td><td>"+ searchParams.getAll('mvtTs') + "</b></td></tr>"; 
                    newHTML +="<tr class='bg-FindClick'><td>uguid </td><td>"+ searchParams.getAll('uguid') + "</b></td></tr>"; 
                    newHTML +="<tr class='bg-FindClick'><td>channelId </td><td>"+ searchParams.getAll('channelId') + "</b></td></tr>"; 
                    newHTML +="<tr class='bg-FindClick'><td>s </td><td>"+ searchParams.getAll('s') + "</b></td></tr>"; 
                    newHTML +="<tr class='bg-FindClick'><td>pg </td><td>"+ searchParams.getAll('pg') + "</b></td></tr>"; 
                    newHTML +="<tr class='bg-FindClick'><td>page </td><td>"+ searchParams.getAll('page') + "</b></td></tr>"; 
                    newHTML +="<tr class='bg-FindClick'><td>query </td><td>"+ searchParams.getAll('query') + "</b></td></tr>"; 
                    newHTML +="<tr class='bg-FindClick'><td>lang </td><td>"+ searchParams.getAll('lang') + "</b></td></tr>"; 
                    newHTML +="<tr class='bg-FindClick'><td>p </td><td>"+ searchParams.getAll('p') + "</b></td></tr>"; 
                    newHTML +="<tr class='bg-FindClick'><td>ct </td><td>"+ searchParams.getAll('ct') + "</b></td></tr>"; 
                    newHTML +="<tr class='bg-FindClick'><td>ind </td><td>"+ searchParams.getAll('ind') + "</b></td></tr>"; 
                    newHTML +="<tr class='bg-FindClick'><td>redirect </td><td>"+ searchParams.getAll('redirect') + "</b></td></tr>"; 
                newHTML +="</table>";
            }else if(api == "/rrserver/click"){
                newHTML +="<table border='0' class='bg-RecsClick'>";
                    newHTML +="<tr class='bg-RecsClick'><td ><b>API </b></td><td><b>"+api + "</b></td></tr>";
                    newHTML +="<tr class='bg-RecsClick'><td>a </td><td>"+ searchParams.getAll('a') + "</td></tr>";  
                    newHTML +="<tr class='bg-RecsClick'><td>vg </td><td>"+ searchParams.getAll('vg') + "</td></tr>";  
                    newHTML +="<tr class='bg-RecsClick'><td>pti </td><td>"+ searchParams.getAll('pti') + "</b></td></tr>";
                    newHTML +="<tr class='bg-RecsClick'><td>pa </td><td>"+ searchParams.getAll('pa') + "</b></td></tr>"; 
                    newHTML +="<tr class='bg-RecsClick'><td>hpi </td><td>"+ searchParams.getAll('hpi') + "</b></td></tr>";  
                    newHTML +="<tr class='bg-RecsClick'><td>rti </td><td>"+ searchParams.getAll('rti') + "</b></td></tr>"; 
                    newHTML +="<tr class='bg-RecsClick'><td>sgs </td><td>"+ searchParams.getAll('sgs') + "</b></td></tr>"; 
                    newHTML +="<tr class='bg-RecsClick'><td>qsgs </td><td>"+ searchParams.getAll('qsgs') + "</b></td></tr>"; 
                    newHTML +="<tr class='bg-RecsClick'><td>u </td><td>"+ searchParams.getAll('u') + "</b></td></tr>"; 
                    newHTML +="<tr class='bg-RecsClick'><td>mvtId </td><td>"+ searchParams.getAll('mvtId') + "</b></td></tr>"; 
                    newHTML +="<tr class='bg-RecsClick'><td>mvtTs </td><td>"+ searchParams.getAll('mvtTs') + "</b></td></tr>"; 
                    newHTML +="<tr class='bg-RecsClick'><td>uguid </td><td>"+ searchParams.getAll('uguid') + "</b></td></tr>"; 
                    newHTML +="<tr class='bg-RecsClick'><td>channelId </td><td>"+ searchParams.getAll('channelId') + "</b></td></tr>";
                    newHTML +="<tr class='bg-RecsClick'><td>s </td><td>"+ searchParams.getAll('s') + "</b></td></tr>"; 
                    newHTML +="<tr class='bg-RecsClick'><td>pg </td><td>"+ searchParams.getAll('pg') + "</b></td></tr>";
                    newHTML +="<tr class='bg-RecsClick'><td>p </td><td>"+ searchParams.getAll('p') + "</b></td></tr>"; 
                    newHTML +="<tr class='bg-RecsClick'><td>ct </td><td>"+ searchParams.getAll('ct') + "</b></td></tr>"; 
                    newHTML +="<tr class='bg-RecsClick'><td>redirect </td><td>"+ searchParams.getAll('redirect') + "</b></td></tr>"; 
            } else if(api == "/rrserver/api/find/v1/autocomplete/e20fd45b1e19a8c6"){
                newHTML +="<table border='0' class='bg-Autocomplete'>";
                    newHTML +="<tr class='bg-Autocomplete'><td><b>Placement </b></td><td><b>"+ searchParams.getAll('placement') + "</b></td></tr>";  
                    newHTML +="<tr class='bg-Autocomplete'><td ><b>API </b></td><td><b>"+api + "</b></td></tr>";
                    newHTML +="<tr class='bg-Autocomplete'><td>Query</td><td>"+ searchParams.getAll('query') + "</b></td></tr>";
                    newHTML +="<tr class='bg-Autocomplete'><td>User Id </td><td>"+ searchParams.getAll('userId') + "</b></td></tr>"; 
                    newHTML +="<tr class='bg-Autocomplete'><td>Session Id </td><td>"+ searchParams.getAll('sessionId') + "</b></td></tr>";  
                    newHTML +="<tr class='bg-Autocomplete'><td>Rcs </td><td>"+ searchParams.getAll('rcs') + "</b></td></tr>"; 
                    newHTML +="<tr class='bg-Autocomplete'><td>start</td><td>"+ searchParams.getAll('start') + "</b></td></tr>";  
                    newHTML +="<tr class='bg-Autocomplete'><td>Rows </td><td>"+ searchParams.getAll('rows') + "</b></td></tr>"; 
                    newHTML +="<tr class='bg-Autocomplete'><td>Log </td><td>"+ searchParams.getAll('log') + "</b></td></tr>";  
                    newHTML +="<tr class='bg-Autocomplete'><td>Fl </td><td>"+ searchParams.getAll('fl') + "</b></td></tr>"; 
                    newHTML +="<tr class='bg-Autocomplete'><td>filter </td><td>"+ searchParams.getAll('filter') + "</b></td></tr>";  
                    newHTML +="<tr class='bg-Autocomplete'><td>lang </td><td>"+ searchParams.getAll('lang') + "</b></td></tr>"; 
                    newHTML +="<tr class='bg-Autocomplete'><td>facetDepth </td><td>"+ searchParams.getAll('facetDepth') + "</b></td></tr>"; 
                    newHTML +="<tr class='bg-Autocomplete'><td>ssl </td><td>"+ searchParams.getAll('ssl') + "</b></td></tr>"; 
                newHTML +="</table>";
            }
            console.log(newHTML);
            let content = getTag('content');
            content.insertAdjacentHTML('afterbegin',newHTML);
        };
        function validate(requests){
            var rcsCount = 0;
            var rcsArray = [];
            let newURL = '';
            let requestsLines = requests.split(';');

            for (const r of requestsLines) {
                newURL = "https://www.richrelevance.com/?validate"+r;
                readRequest(newURL,rcsCount,rcsArray);
            }

        }
        function init(){
            var targetFile = getTag("targetFile");
            var fileReader = new FileReader();
            var str = "";
            fileReader.onload = function(e){
                str += splitLines(fileReader.result);
                validate(str);
            }
            targetFile.addEventListener('change',function(e){
                var file = targetFile.files[0];
                fileReader.readAsText(file);
            });
        }
    </script>
</head>
<body onload="init();">
    Please select the file:
    <input type="file" id="targetFile" /><br/>


    <fieldset>
        <legend>Filter by:</legend>
    
        <div>
          <input type="checkbox" id="RecsForPlacements" name="RecsForPlacements" checked value="bg-recs4P">
          <label for="RecsForPlacements" style="background-color: #c3e3ff">RecsForPlacements</label>
        </div>
    
        <div>
          <input type="checkbox" id="Find" name="Find" checked value="bg-Find">
          <label for="Find" style="background-color: #f9fcb3">Find</label>
        </div>
    
        <div>
            <input type="checkbox" id="Autocomplete" name="Autocomplete" checked value="bg-Autocomplete">
            <label for="Autocomplete" style="background-color: #fcdea2">Autocomplete</label>
          </div>

        <div>
          <input type="checkbox" id="Engage" name="Engage" checked value="bg-Personalize">
          <label for="Engage" style="background-color: #f9c3ff">Engage</label>
        </div>
    
        <div>
          <input type="checkbox" id="Discover" name="Discover" checked value="bg-Discover">
          <label for="Discover" style="background-color: #a2fcc1">Discover</label>
        </div>
        </div>
    
        <div>
          <input type="checkbox" id="Recs-Clicks" name="Recs-Clicks" checked value="bg-RecsClick">
          <label for="Recs-Clicks" style="background-color:#cccccc">Recs Clicks</label>
        </div>
        </div>
    
        <div>
          <input type="checkbox" id="Find-Clicks" name="Find-Clicks" checked value="bg-FindClick">
          <label for="Find-Clicks" style="background-color: #d7d89f">Find Clicks</label>
        </div>
    </fieldset>

    <div id="content">
        <br />
    </div>

    <script>
        $(document).ready(function() {
                $('input[type="checkbox"]').click(function() {
                    var inputValue = $(this).attr("value");
                    $("." + inputValue).toggle();
                });
        });
    </script>

</body>
</html>