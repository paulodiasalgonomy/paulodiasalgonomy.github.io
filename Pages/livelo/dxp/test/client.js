"use strict";var RR;(RR=void 0===RR?{}:RR).experienceConstants={previewParameter:"ebpPreview",frequencies:{ONCE_PER_PAGE_VIEW:"ONCE_PER_PAGE_VIEW",ONCE_PER_SESSION:"ONCE_PER_SESSION",ONCE_PER_DAY:"ONCE_PER_DAY",ONCE_PER_WEEK:"ONCE_PER_WEEK",ONCE_PER_MONTH:"ONCE_PER_MONTH",ONCE_PER_USER:"ONCE_PER_USER"},experienceTypes:{MESSAGE:"MESSAGE"},triggerTypes:{PAGE_LOAD:"PAGE_LOAD",TIME_ON_PAGE:"TIME_ON_PAGE",TIME_ON_SITE:"TIME_ON_SITE",EXIT_INTENT:"EXIT_INTENT"},urls:{engageTargetingUrl:".richrelevance.com/rrserver/api/engage/targeting",experienceUrl:".richrelevance.com/rrserver/api/engage/experiences",trackExperienceEvent:".richrelevance.com/rrserver/api/engage/trackExperienceEvent"},frequenciesTime:{ONCE_PER_PAGE_VIEW:0,ONCE_PER_SESSION:1,ONCE_PER_USER:2,ONCE_PER_DAY:864e5,ONCE_PER_WEEK:6048e5,ONCE_PER_MONTH:2629743833},storageKey:{PREVIOUS_SESSION_ID_KEY:"xin_p_s_i",GENERATED_EXPERIENCE_SESSION_ID_KEY:"xin_g_s_i",EXPERIENCE_USER_ID_KEY:"xin_u_i",USER_VIEWED_VALUE:"v",THIS_BROWSER_VIEWED:"xin_t_b_v",SHOWED_TIME_KEY:"xin_f_t",PRESENCE_TIME_ON_SITE_KEY:"xin_p_t_o_s",VARIATION_IDS:"xin_v_i"},halfHourMs:18e5,weekMs:6048e5},RR.experience={shownOnPageExperiences:new Set,c:function(e,n,t,r){function i(e){document.cookie=e+"=;path=/;expires=Thu, 01-Jan-1970 00:00:01 GMT";try{localStorage.removeItem(e)}catch(e){}}if(!0===RR.experience.get("noCookieMode"))return i(e),"";if(null==n){if(-1!=t){if(0<document.cookie.length)for(var s=document.cookie.split(";").reverse(),o=0,a=s.length;o<a;o++){var c,E=s[o],R=(E="function"==typeof E.trim?E.trim():E.replace(/^\s+|\s+$/g,"")).indexOf(e+"=");if(0===R)return R=R+e.length+1,c=E.length,unescape(E.substring(R,c))}try{var g=(g=new Date).getTime();if((d=JSON.parse(localStorage.getItem(e)))&&d.expires>g)return d.value}catch(e){}return""}i(e)}else{g=";SameSite=None;Secure";if(t){var p=new Date,r=r?function(e){e=e.split(".").reverse();return 3<=e.length&&e[1].match(/^(com|edu|gov|net|mil|org|nom|co|name|info|biz)$/i)?e[2]+"."+e[1]+"."+e[0]:e[1]+"."+e[0]}(window.location.hostname):"",p=new Date(p.getTime()+1e3*t*60*60*24);document.cookie=e+"="+escape(n)+";path=/;domain="+r+";expires="+p.toUTCString()+g;try{var d={value:n,expires:p.getTime()};localStorage.setItem(e,JSON.stringify(d))}catch(e){}}else document.cookie=e+"="+escape(n)+g}},get:function(e){var n=window.R3_COMMON[e];return n=void 0===n&&"function"==typeof RR.get?RR.get(e):n},getRcs:function(){return window.R3_COMMON.rcs||RR.experience.c("rr_rcs")},init:function(){var e=this.findGetParameter(RR.experienceConstants.previewParameter);void 0!==e?this.showTestExperience(e):(RR.experience.isFinishedTwoRequests=2,this.setNewTimePresenceOnSite(),this.loadTargetingAndExperiencesRunTimeout(this.startShowing.bind(this)))},startShowing:function(){0==--RR.experience.isFinishedTwoRequests&&(this.maxCount=this.ignoringPriorityVariationCount(RR.experience.experiences)+RR.experience.experiences.length,this.showExperiencePageLoadTrigger(),this.runTimeoutToShowExperience(RR.experienceConstants.triggerTypes.TIME_ON_PAGE),this.runTimeoutToShowExperience(RR.experienceConstants.triggerTypes.TIME_ON_SITE),this.attachExitIntentExperiences())},showExperiencePageLoadTrigger:function(){var e=this.getSuitableExperience(RR.experienceConstants.triggerTypes.PAGE_LOAD);if(e){e=this.takeLeftExperiences(e),this.maxCount-=e.length;for(var n=0;n<e.length;n++)this.showExperience(e[n])}},runTimeoutToShowExperience:function(e){var n=this.getSuitableExperienceAndParams(e);if(n)for(var t=0;t<n.length&&0<this.maxCount;t++){var r=n[t];this.maxCount--,setTimeout(this.showExperienceAndRunTimeout.bind(this,r.experience),r.showAfterTimeInMs)}},ignoringPriorityVariationCount:function(e){for(var n=0,t=0;t<e.length;t++)e[t].ignorePriorities&&n++;return n},takeLeftExperiences:function(e){for(var n=[],t=0;t<e.length;t++)n.push(e[t]);return n},showExperienceAndRunTimeout:function(e){this.showExperience(e)},attachExitIntentExperiences:function(){document.addEventListener("mouseleave",function(e){e=e||window.event;var n=Math.max(document.documentElement.clientWidth,window.innerWidth||0);if(!(e.clientX>=n-50||50<=e.clientY)){var t=RR.experience.getSuitableExperience(RR.experienceConstants.triggerTypes.EXIT_INTENT);if(t)for(var r=0;r<t.length&&0<this.maxCount;r++)this.maxCount--,RR.experience.showExperience(t[r])}}.bind(this),!1)},getEngageTargeting:function(n){this.sendRequestWithFallback(this.getEngageTargetingUrl()).then(function(e){e&&(RR.experience.segmentIds=e.segmentIds,RR.experience.contextIds=e.contextIds,e.error&&console.error("Targeting request error: "+e.error),n())})},getExperiences:function(n){this.sendRequestWithFallback(this.getEngageExperiencesUrl()).then(function(e){e&&(RR.experience.experiences=e.experiences,e.error&&console.error("Experiences request error: "+e.error),RR.experience.storeVariationIds(),n())})},loadTargetingAndExperiencesRunTimeout:function(e){this.getEngageTargeting(e),this.clearObsoleteVariationIds(),this.getExperiences(e)},appendCssToHead:function(e){var n;e&&((n=document.createElement("style")).type="text/css",n.innerHTML=e,document.getElementsByTagName("head")[0].appendChild(n))},appendHtml:function(e){var n=document.createElement("div");n.innerHTML=e.layout.html,this.addListeners(e,n),document.getElementsByTagName("body")[0].appendChild(n)},appendJsAndRunJs:function(e){var n;e&&((n=document.createElement("script")).type="text/javascript",n.innerHTML=e,document.getElementsByTagName("body")[0].appendChild(n))},markNewShownDate:function(e){var n=this.parseJsonOrGetEmptyObject(localStorage[RR.experienceConstants.storageKey.SHOWED_TIME_KEY]);n[e]=Date.now(),localStorage[RR.experienceConstants.storageKey.SHOWED_TIME_KEY]=JSON.stringify(n)},markShownForUser:function(e){var n=window.R3_COMMON.userId;void 0!==n&&""!==n?localStorage[RR.experienceConstants.storageKey.EXPERIENCE_USER_ID_KEY+e]=n:localStorage[RR.experienceConstants.storageKey.THIS_BROWSER_VIEWED+e]=RR.experienceConstants.storageKey.USER_VIEWED_VALUE},markShownForSession:function(e){localStorage[RR.experienceConstants.storageKey.PREVIOUS_SESSION_ID_KEY+e]=this.getSessionId()},showExperience:function(e){var n=/"<%=\s*variables\s*%>"/g,n=(n.test(e.layout.js)&&(e.layout.js=e.layout.js.replace(n,JSON.stringify(e.layout.variables))),this.appendCssToHead(e.layout.css),this.appendHtml(e),this.appendJsAndRunJs(e.layout.js),e.frequency===RR.experienceConstants.frequencies.ONCE_PER_USER&&this.markShownForUser(e.id),e.frequency===RR.experienceConstants.frequencies.ONCE_PER_SESSION&&this.markShownForSession(e.id),this.markNewShownDate(e.id),this.getTrackExperienceEventUrl(e.id,e.variationId));this.listener(n,this.experienceTriggerToTrackingTriggerType(e),"view",e),this.shownOnPageExperiences.add(e.id)},listener:function(e,n,t,r){e=e+"&triggerType="+this.experienceTriggerToTrackingTriggerType(r.trigger.type)+"&eventType="+t;"SP_MESSAGE"===r.type?window.RR.trackExperienceEventUrl=e:this.sendRequestWithFallback(e).then(function(e){e&&"OK"!==e.status.toUpperCase()&&console.error("error when tracking experience events")})},trackSPExperienceListener:function(e){this.trackSPExperienceEventUrl&&(e=this.trackSPExperienceEventUrl+"&isSpMessageShown="+e,this.sendRequestWithFallback(e).then(function(e){e&&"OK"!==e.status.toUpperCase()&&console.error("error when tracking experience events")}))},experienceTriggerToTrackingTriggerType:function(e){switch(e){case"PAGE_LOAD":return"pageload";case"TIME_ON_SITE":return"timeonsite";case"TIME_ON_PAGE":return"timeonpage";case"EXIT_INTENT":return"exitintent";default:return"click"}},track:function(e,n,t,r,i,s){for(var o=s.getElementsByClassName(t),a=0;a<o.length;a++)o[a].dataset.listened||(o[a].setAttribute("data","listened: 'true'"),o[a].addEventListener(n,this.listener.bind(this,e,t,r,i)))},addListeners:function(e,n){var t=this.getTrackExperienceEventUrl(e.id,e.variationId);this.track(t,"click","click-trigger","click",e,n),this.track(t,"focus","input-trigger","input",e,n),this.track(t,"submit","submit-trigger","submit",e,n),this.track(t,"click","hide-trigger","hide",e,n)},showTestExperience:function(e){var t=this.showExperience.bind(this);this.getTestExperience(e,function(e){var n=""===e.trigger.triggerConfig?0:1e3*e.trigger.triggerConfig;setTimeout(t,n,e)})},findGetParameter:function(e){for(var n,t=location.search.substr(1).split("&"),r=0;r<t.length;r++)if((n=t[r].split("="))[0]===e)return decodeURIComponent(n[1])},setNewTimePresenceOnSite:function(){var e=localStorage[RR.experienceConstants.storageKey.PRESENCE_TIME_ON_SITE_KEY],n=Date.now(),t=this.parseJsonOrGetEmptyObject(e);(void 0===e||n-t.lastOpen>RR.experienceConstants.halfHourMs&&void 0===t.sessionId||t.sessionId!==R3_COMMON.sessionId)&&(t.fistOpen=n),t.sessionId=R3_COMMON.sessionId,t.lastOpen=n,localStorage[RR.experienceConstants.storageKey.PRESENCE_TIME_ON_SITE_KEY]=JSON.stringify(t)},parseJsonOrGetEmptyObject:function(e){try{return JSON.parse(e)}catch(e){return{}}},getTestExperience:function(e,n){this.sendRequestWithFallback(this.getEngageExperiencesUrl(e)).then(function(e){e&&(e.error&&console.error("Experiences request error: "+e.error),0<(e=e.experiences).length)&&n(e[0])})},getSessionId:function(){var e=window.R3_COMMON.sessionId;return void 0!==e||(e=localStorage[RR.experienceConstants.storageKey.GENERATED_EXPERIENCE_SESSION_ID_KEY],Date.now()-e<RR.experienceConstants.halfHourMs)?e:(e=Date.now(),localStorage[RR.experienceConstants.storageKey.GENERATED_EXPERIENCE_SESSION_ID_KEY]=e)},getPresenceTimeInSecOnPage:function(){var e=Date.now();return void 0===this.presenceTimeOnPage?(this.presenceTimeOnPage=e,0):Math.round((e-this.presenceTimeOnPage)/1e3)},getPresenceTimeInSecOnSite:function(){var e=Date.now(),n=localStorage[RR.experienceConstants.storageKey.PRESENCE_TIME_ON_SITE_KEY],n=this.parseJsonOrGetEmptyObject(n);return Math.round((e-n.fistOpen)/1e3)},getEngageTargetingUrl:function(){var e=this.constructUrl(this.getEnvironment(),RR.experienceConstants.urls.engageTargetingUrl),n=(e+="?apiClientKey="+R3_COMMON.apiClientKey+"&apiKey="+R3_COMMON.apiKey,window.R3_COMMON.userId&&(e+="&userId="+window.R3_COMMON.userId),window.R3_COMMON.sessionId&&(e+="&sessionId="+window.R3_COMMON.sessionId),RR.experience.getRcs()),n=(n&&(e+="&rcs="+n),window.R3_COMMON.categoryData&&(e+="&categoryData="+window.R3_COMMON.categoryData),window.R3_COMMON.fpb&&(e+="&fpb="+window.R3_COMMON.fpb),window.R3_COMMON.includeRcs&&(e+="&includeRcs="+window.R3_COMMON.includeRcs),null);if(window.R3_COMMON.placements)n=window.R3_COMMON.placements;else try{n=RR.get.call(R3_COMMON,"placementTypes").split("|")[1]}catch(e){n=null}n&&(e+="&placements="+n),window.R3_COMMON.pref&&(e+="&pref="+window.R3_COMMON.pref),window.R3_COMMON.recentlyPurchased&&(e+="&recentlyPurchased="+window.R3_COMMON.recentlyPurchased),window.R3_COMMON.segments&&(e+="&sgs="+window.R3_COMMON.segments),window.R3_COMMON.userAttribute&&(e+="&userAttribute="+window.R3_COMMON.userAttribute),window.R3_COMMON.atcid&&(e+="&atcid="+window.R3_COMMON.atcid),window.R3_COMMON.categoryId&&(e+="&categoryId="+window.R3_COMMON.categoryId),window.R3_ITEM&&window.R3_ITEM.id?e+="&p="+window.R3_ITEM.id:window.R3_COMMON.productId&&(e+="&productId="+window.R3_COMMON.productId),window.R3_COMMON.attribute&&(e+="&attribute="+window.R3_COMMON.attribute),window.R3_COMMON.categoryName&&(e+="&cn="+window.R3_COMMON.categoryName);n=R3_COMMON.regionId||R3_COMMON.region;return n&&(e+="&rid="+n),window.R3_COMMON.searchTerm&&(e+="&searchTerm="+window.R3_COMMON.searchTerm),window.R3_COMMON.channelId&&(e+="&channelId="+window.R3_COMMON.channelId),window.R3_COMMON.cartValue&&(e+="&cv="+window.R3_COMMON.cartValue),e},getEngageExperiencesUrl:function(e){var n=this.constructUrl(this.getEnvironment(),RR.experienceConstants.urls.experienceUrl),e=(n+="?apiClientKey="+R3_COMMON.apiClientKey+"&apiKey="+R3_COMMON.apiKey,void 0!==e&&(n+="&preview="+e),this.getStoredVariationIds()),e=(e.length&&(n+="&variations="+e.map(function(e){return e.id}).join(",")),window.R3_COMMON&&window.R3_COMMON.sessionId&&(n+="&s="+window.R3_COMMON.sessionId),window.R3_COMMON&&window.R3_COMMON.userId&&(n+="&u="+window.R3_COMMON.userId),RR.experience.getRcs());return e&&(n+="&rcs="+e),n},getTrackExperienceEventUrl:function(e,n){var t=this.constructUrl(this.getEnvironment(),RR.experienceConstants.urls.trackExperienceEvent),e=(t+="?apiKey="+R3_COMMON.apiKey+"&s="+this.getSessionId()+"&experienceId="+e+"&variationId="+n,window.R3_COMMON.userId),n=(e&&(t+="&userId="+e),RR.experience.getRcs());return n&&(t+="&rcs="+n),window.R3_ITEM&&window.R3_ITEM.id?t+="&productId="+window.R3_ITEM.id:window.R3_COMMON.itemIds&&(t+="&productId="+window.R3_COMMON.itemIds),t},getEnvironment:function(){var n,e=this.findGetParameter("r3_env");try{n=(n=R3_COMMON&&R3_COMMON.baseUrl?R3_COMMON.baseUrl:RR.get.call(R3_COMMON,"baseUrl")).split("//")[1].split(".richrelevance.com")[0]}catch(e){n=""}return n||e||"recs"},constructUrl:function(e,n){return"https://"+e+n},sendRequest:function(e,n){var t=new URL(e),r=t.searchParams,i=e,e=n&&n.method?n.method.toUpperCase():"POST",s={method:e,referrerPolicy:"no-referrer-when-downgrade"};switch(e){case"POST":case"PUT":var o,a=r&&r.get("rcs");a&&((o=new URLSearchParams).append("rcs",a),s.body=o,r.delete("rcs"),i=t.origin+t.pathname+t.search)}if(window.fetch)return window.fetch(i,s).then(function(e){return e.ok?e.json():Promise.reject(e.status+": "+e.statusText)}).catch(function(e){console.log("error when request to server ",e)})},sendRequestWithFallback:async function(n){var t=this.sendRequest;return!1===RR.experience.get("noThirdPartyCookies")?t(n,{method:"GET"}):t(n).then(function(e){return e||t(n,{method:"GET"})})},getPresenceTimeInSec:function(e){return e===RR.experienceConstants.triggerTypes.TIME_ON_PAGE?this.getPresenceTimeInSecOnPage():this.getPresenceTimeInSecOnSite()},getShowAfterTimeInMs:function(e,n){return 1e3*(e.trigger.triggerConfig-this.getPresenceTimeInSec(n))},getSuitableExperience:function(e){for(var n=[],t=0;t<RR.experience.experiences.length;t++){var r=RR.experience.experiences[t];r.trigger.type===e&&this.isSuitableSegmentAndContext(r)&&!this.isShownExperience(r)&&this.isSuitableDatePeriod(r)&&n.push(r)}return n},getSuitableExperienceAndParams:function(e){for(var n=[],t=0;t<RR.experience.experiences.length;t++){var r=RR.experience.experiences[t],i=this.getShowAfterTimeInMs(r,e);r.trigger.type===e&&0<i&&!this.isShownExperience(r)&&this.isSuitableSegmentAndContext(r)&&this.isSuitableDatePeriod(r)&&n.push({experience:r,showAfterTimeInMs:i,nextIndex:t+1})}return n},isSuitableDatePeriod:function(e){var n=Date.parse(e.startDate),t=Date.parse(e.endDate),r=Date.now();return(!e.startDate||n<=r)&&(!e.endDate||r<=t)},isShownExperience:function(e){var n=this.parseJsonOrGetEmptyObject(localStorage[RR.experienceConstants.storageKey.SHOWED_TIME_KEY])[e.id];if(void 0===n)return!1;var t=Date.now()-n;switch(e.frequency){case RR.experienceConstants.frequencies.ONCE_PER_PAGE_VIEW:return this.shownOnPageExperiences.has(e.id);case RR.experienceConstants.frequencies.ONCE_PER_USER:return this.isShownToUser(e.id);case RR.experienceConstants.frequencies.ONCE_PER_SESSION:return this.isShownInSession(e.id);case RR.experienceConstants.frequencies.ONCE_PER_DAY:return t<RR.experienceConstants.frequenciesTime.ONCE_PER_DAY;case RR.experienceConstants.frequencies.ONCE_PER_WEEK:return t<RR.experienceConstants.frequenciesTime.ONCE_PER_WEEK;case RR.experienceConstants.frequencies.ONCE_PER_MONTH:return t<RR.experienceConstants.frequenciesTime.ONCE_PER_MONTH}},isShownToUser:function(e){var n=window.R3_COMMON.userId;if(void 0!==n&&""!==n&&localStorage[RR.experienceConstants.storageKey.EXPERIENCE_USER_ID_KEY+e]===n)return!0;return localStorage[RR.experienceConstants.storageKey.THIS_BROWSER_VIEWED+e]===RR.experienceConstants.storageKey.USER_VIEWED_VALUE},isShownInSession:function(e){var n=this.getSessionId();return localStorage[RR.experienceConstants.storageKey.PREVIOUS_SESSION_ID_KEY+e]===n||(localStorage[RR.experienceConstants.storageKey.PREVIOUS_SESSION_ID_KEY+e]=n,!1)},isSuitableSegmentAndContext:function(e){return(!e.segmentId||-1<RR.experience.segmentIds.indexOf(e.segmentId))&&(!e.contextId||-1<RR.experience.contextIds.indexOf(e.contextId))},clearObsoleteVariationIds:function(){var e=this.getStoredVariationIds(),n=Date.now(),e=e.filter(function(e){return n-e.timestamp<RR.experienceConstants.weekMs});localStorage[RR.experienceConstants.storageKey.VARIATION_IDS]=JSON.stringify(e)},storeVariationIds:function(){for(var e=this.getStoredVariationIds(),n=new Set,t=0;t<e.length;t++)n.add(e[t].id);if(void 0!==RR.experience.experiences){for(t=0;t<RR.experience.experiences.length;t++)n.has(RR.experience.experiences[t].variationId)||e.push({id:RR.experience.experiences[t].variationId,timestamp:Date.now()});localStorage[RR.experienceConstants.storageKey.VARIATION_IDS]=JSON.stringify(e)}},getStoredVariationIds:function(){try{return JSON.parse(localStorage[RR.experienceConstants.storageKey.VARIATION_IDS])}catch(e){return[]}}};try{RR.experience.init()}catch(e){console.error("error when experience showing",e)}